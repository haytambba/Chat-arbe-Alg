<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Chat AlgÃ©rie</title>
<style>
body {
  font-family: Arial;
  background: #111;
  color: #fff;
  margin: 0;
}
#chat-box {
  height: 70vh;
  overflow-y: scroll;
  padding: 10px;
  background: #222;
}
.message {
  padding: 8px;
  margin: 5px 0;
  border-radius: 5px;
}
.you {
  background: #0a84ff;
  text-align: right;
}
.other {
  background: #444;
  text-align: left;
}
input {
  width: 80%;
  padding: 10px;
  border: none;
  border-radius: 5px;
}
button {
  width: 18%;
  padding: 10px;
  border: none;
  border-radius: 5px;
  background: #0a84ff;
  color: #fff;
}
</style>
</head>

<body>

<h2 style="text-align:center">ðŸ’¬ Chat AlgÃ©rie</h2>

<div id="chat-box"></div>

<div style="display:flex; gap:5px; padding:10px;">
  <input id="msg" placeholder="Ø£ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø©..." />
  <button onclick="sendMsg()">Ø¥Ø±Ø³Ø§Ù„</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, addDoc, serverTimestamp, query, orderBy, onSnapshot } 
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCmZOwHDaMkpJtl9Is4p7YuhjtFZZ7pHv4",
  authDomain: "chat-algerie-a2c71.firebaseapp.com",
  projectId: "chat-algerie-a2c71",
  storageBucket: "chat-algerie-a2c71.firebasestorage.app",
  messagingSenderId: "122054820778",
  appId: "1:122054820778:web:9997e980072fb4014be1d3",
  measurementId: "G-MYRPJ3CMNB"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const chatBox = document.getElementById("chat-box");
const msgInput = document.getElementById("msg");

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ù…Ø¨Ø§Ø´Ø±Ø©
const q = query(collection(db, "messages"), orderBy("time"));
onSnapshot(q, (snapshot) => {
  chatBox.innerHTML = "";
  snapshot.forEach((doc) => {
    let data = doc.data();
    let div = document.createElement("div");
    div.className = "message other";
    div.innerText = data.text;
    chatBox.appendChild(div);
  });
  chatBox.scrollTop = chatBox.scrollHeight;
});

// Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø©
async function sendMsg() {
  let text = msgInput.value.trim();
  if (text === "") return;

  await addDoc(collection(db, "messages"), {
    text: text,
    user: "user",
    time: serverTimestamp()
  });

  msgInput.value = "";
}
</script>

</body>
</html>
